# Скрипт отправки запроса закрывающих документов в RU-VDS

[RU-VDS](https://ruvds.com/) не выставляет закрыващие документы по каналам ЭДО в автоматическом режиме. На протяжении двух лет все мои клиенты вынуждены клянчить документы раз в квартал. Тут я решил, раз уж они итак арендуют у них сервера, так пусть с них и идет отправка запросов.

Это банальный скрипт отправки без наворотов. Работает через SMTP-сервер (по умолчанию smtp.yandex.ru) с SSL по-умолчанию.

## Установка
1. Скачайте файл [`send-ruvds-docs.ps1`](./send-ruvds-docs.ps1) в отдельную папку.  
2. Для PowerShell 5.1 сохраните файл в кодировке **UTF-8 с BOM** (иначе возможны проблемы с кириллицей в отправленных сообщениях).  
3. При необходимости создайте пароль приложения в настройках почтового сервиса (например, Яндекс.Почты).
4. Для отправки сообщений через Яндекс.Почту требуется **включение imap** в настройках почты обязательно.
5. Создайте задание в планировщике заданий на выполнение скрипта раз в месяц.
6. В некоторых системах возможна ошибка запуска даже с Bypass, скорее всего в свойствах файла будет стоять блокировка, так как файл получен из сети. Разблокируйте.

## Использование

Минимальный запуск (Яндекс, порт 587 по умолчанию):  

```
powershell -ExecutionPolicy Bypass -File .\send-ruvds-docs.ps1 -From user@yandex.ru -AppPassword 'ПАРОЛЬ'
```

Указание альтернативного SMTP-сервера и лога:

```
powershell -ExecutionPolicy Bypass -File .\send-ruvds-docs.ps1 -From user@domain.com -User user@domain.com -AppPassword 'PASSWORD' -SmtpServer smtp.domain.com -SmtpPort 465 -LogPath "C:\Logs\ruvds-docs.log"
```

## Параметры

| Параметр       | Обязательный | Значение по умолчанию | Описание                             |
| -------------- | ------------ | --------------------- | ------------------------------------ |
| `-From`        | да           | —                     | Адрес отправителя.                   |
| `-To`          | нет          | `support@ruvds.com`   | Адрес получателя.                    |
| `-User`        | нет          | `From`                | Логин для SMTP.                      |
| `-AppPassword` | да           | —                     | Пароль/ пароль приложения почтового сервиса. |
| `-LogPath`     | нет          | `ruvds-docs.log`      | Путь к файлу лога (по-умолчанию в каталоге скрипта).|
| `-SmtpServer`  | нет          | `smtp.yandex.ru`      | SMTP-сервер.                         |
| `-SmtpPort`    | нет          | `587`                 | Порт SMTP.                           |

## Пример тела письма

```
Здравствуйте.

Просим предоставить закрывающие документы за <месяц> по нашему договору/лицевому счёту.
Готовы подтвердить данные и предоставить при необходимости доп. информацию.

Спасибо.
```
